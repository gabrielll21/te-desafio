<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}"></head>
<body>
    <nav th:replace="~{layout :: navbar}"></nav>
    <main th:replace="~{layout :: main}">
        <th:block th:fragment="content">
            <div class="page-header">
                <h1 class="page-title">Convites de Desafio Recebidos</h1>
                <p class="page-subtitle">Aceite ou recuse convites de desafio</p>
            </div>

            <div class="action-buttons">
                <a th:href="@{/convites/enviados}" class="btn btn-outline">Ver Convites Enviados</a>
                <a th:href="@{/desafios}" class="btn btn-secondary">Ver Todos os Desafios</a>
            </div>

            <div th:if="${error != null}" class="alert alert-error" style="margin-bottom: 1.5rem;">
                <strong>Erro:</strong> <span th:text="${error}"></span>
            </div>

            <div th:if="${recebidos != null and !recebidos.empty}" class="grid grid-2">
                <div class="card" th:each="convite : ${recebidos}">
                    <div class="card-header">
                        <h3 class="card-title" th:text="${convite.desafio.titulo}">T√≠tulo do Desafio</h3>
                        <div style="margin-top: 0.5rem; padding: 0.75rem; background: rgba(100, 255, 218, 0.1); 
                             border-radius: var(--border-radius); border-left: 3px solid var(--accent);">
                            <p style="color: var(--accent); font-weight: 600; margin: 0; font-size: 0.95rem;">
                                üì® Convite de: <strong th:text="${convite.remetente != null ? convite.remetente.nome : 'Usu√°rio'}">Nome do Remetente</strong>
                            </p>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.25rem; margin-bottom: 0;">
                                <span th:text="${convite.remetente != null ? convite.remetente.email : 'N/A'}">email@exemplo.com</span>
                            </p>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 1rem;">
                            <p style="color: var(--text-secondary); margin-bottom: 0.5rem; font-weight: 500;">Descri√ß√£o do Desafio:</p>
                            <p style="color: var(--text-primary); font-size: 0.9rem;" 
                               th:text="${#strings.abbreviate(convite.desafio.descricao, 200)}">Descri√ß√£o do desafio...</p>
                        </div>
                        <p th:if="${convite.mensagem != null and !convite.mensagem.isEmpty()}" 
                           style="color: var(--text-secondary); margin-bottom: 1rem; padding: 0.75rem; 
                                  background: rgba(255, 255, 255, 0.05); border-radius: var(--border-radius); 
                                  border-left: 3px solid var(--accent); font-style: italic;"
                           th:text="'üí¨ ' + ${convite.mensagem}">Mensagem</p>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.85rem; color: var(--text-muted);">
                            <span>üìÖ <span th:text="${#temporals.format(convite.desafio.dataInicio, 'dd/MM/yyyy')}"></span> - 
                                  <span th:text="${#temporals.format(convite.desafio.dataFinal, 'dd/MM/yyyy')}"></span></span>
                            <span>‚≠ê Dificuldade: <strong th:text="${convite.desafio.dificuldade}"></strong>/10</span>
                            <span>üèÜ Pontos: <strong th:text="${convite.desafio.pontuacaoMaxima}"></strong></span>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 1rem;">
                            üì¨ Enviado em: <span th:text="${convite.criadoEm != null ? #temporals.format(convite.criadoEm, 'dd/MM/yyyy HH:mm') : 'N/A'}"></span>
                        </p>
                    </div>
                    <div class="card-footer">
                        <a th:href="@{|/desafios/${convite.desafio.id}|}" class="btn btn-outline btn-sm">Ver Detalhes</a>
                        <form th:action="@{/convites/{id}/aceitar(id=${convite.id})}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-primary btn-sm">‚úì Aceitar</button>
                        </form>
                        <form th:action="@{/convites/{id}/recusar(id=${convite.id})}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm">‚úó Recusar</button>
                        </form>
                    </div>
                </div>
            </div>

            <div th:if="${recebidos == null or recebidos.empty}" class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <h3>Nenhum convite recebido</h3>
                <p>Voc√™ n√£o tem convites de desafio pendentes no momento.</p>
            </div>
        </th:block>
    </main>
    <footer th:replace="~{layout :: footer}"></footer>
</body>
</html>
